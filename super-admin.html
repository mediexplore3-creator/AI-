<!DOCTYPE html> 
<html lang="en">  
  <head>    
    <meta charset="UTF-8">    
    <meta name="viewport" content="width=device-width, initial-scale=1.0">    
    <title>Super Admin Panel</title>

    <!-- Google Fonts -->    
	<link href="https://fonts.googleapis.com/css2?family=Audiowide&display=swap" rel="stylesheet">    
	<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;600&display=swap" rel="stylesheet"> 



<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>    
 * { 
    margin: 0; 
    padding: 0; 
    box-sizing: border-box; 
    font-family: 'Orbitron', sans-serif; 
}    

body { 
    background: #001f2e; 
    color: white; 
    text-align: center; 
    padding: 20px; 
}    

/* Admin Panel Title */
.admin-title-container {
    display: flex;
    justify-content: center;
    align-items: center;
    width: 100%;
    padding: 20px 0;
}

.admin-title-box {
    display: inline-block;
    padding: 20px 40px;
    border: 3px solid #7df9ff;
    border-radius: 15px;
    box-shadow: 0px 0px 20px cyan, 0px 0px 40px rgba(0, 255, 255, 0.5);
    background: #FFFFFF;
    text-align: center;
    max-width: 80%;
    overflow: hidden;
}

.admin-title {
    font-size: clamp(24px, 5vw, 50px);
    font-weight: bold;
    text-transform: uppercase;
    font-family: 'Audiowide', sans-serif;
    background: linear-gradient(240deg, #ff0000, #ff7300, #ffff00, #00ff00, #0000ff, #4b0082, #9400d3);
    background-size: 300% 300%;
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    text-shadow: 0px 0px 15px cyan;
    animation: flowingRGB 5s infinite linear;
    text-align: center;
    white-space: normal;  /* Allows text to wrap */
    word-break: break-word;
}

/* Flowing RGB Effect */
@keyframes flowingRGB {
    0% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
    100% { background-position: 0% 50%; }
}

/* Responsive Fixes */
@media (max-width: 768px) {
    .admin-title {
        font-size: 6vw;
    }
    .admin-title-box {
        padding: 15px 25px;
        max-width: 90%;
    }
}

/* User Card List */
.user-card-container {
    width: 90%;
    max-width: 900px;
    margin: 30px auto;
    padding: 20px;
    border: 3px solid cyan;
    border-radius: 15px;
    background: rgba(0, 255, 255, 0.1);
    box-shadow: 0px 0px 15px cyan;
    text-align: center;
}

.user-card-title {
    font-size: clamp(20px, 4vw, 32px);
    font-weight: bold;
    text-transform: uppercase;
    font-family: 'Audiowide', sans-serif;
    color: cyan;
    text-shadow: 0px 0px 15px cyan;
    margin-bottom: 15px;
}

.user-list {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 15px;
    margin-top: 20px;
}

/* User Card */
.user-card {
    background: rgba(0, 255, 255, 0.15);
    padding: 15px;
    border-radius: 10px;
    width: 280px;
    text-align: left;
    border: 2px solid cyan;
    box-shadow: 0 0 10px cyan;
    margin: 10px auto;
    transition: all 0.3s ease;
}

.user-card:hover {
    transform: scale(1.02);
}

/* Button Styles */
button {
    padding: 8px 12px;
    border: none;
    cursor: pointer;
    border-radius: 5px;
    margin-top: 8px;
    font-weight: bold;
    transition: all 0.3s ease;
}

button:hover {
    opacity: 0.8;
    transform: scale(1.05);
}

.extend-btn {
    background: cyan;
    color: black;
}

.delete-btn {
    background: red;
    color: white;
}

/* Gmail Drawer Button */
.gmail-btn {
    position: fixed;
    bottom: 20px;
    left: 20px;
    padding: 15px 20px;
    background: cyan;
    font-size: 16px;
    font-weight: bold;
    border-radius: 50px;
    cursor: pointer;
    box-shadow: 0 0 10px cyan;
}

.gmail-btn:hover {
    background: white;
    color: black;
}

/* Gmail Drawer */
.gmail-drawer {
    position: fixed;
    left: -350px;
    top: 0;
    width: 350px;
    height: 100%;
    background: #002c3d;
    padding: 20px;
    transition: left 0.3s ease-in-out;
    z-index: 10;
    box-shadow: 5px 0px 10px rgba(255, 255, 255, 0.8);
}

/* Close Button */
.gmail-drawer .close-btn {
    position: absolute;
    top: 0px;
    right: 10px;
    font-size: 22px;
    cursor: pointer;
    color: white;
    background: red;
    border-radius: 50%;
    padding: 5px 10px;
    border: none;
}

/* Gmail List Styling */
.gmail-card {
    background: rgba(0, 255, 255, 0.15);
    padding: 15px;
    border-radius: 10px;
    width: 100%;
    text-align: left;
    border: 2px solid cyan;
    box-shadow: 0 0 10px cyan;
    margin: 10px auto;
    transition: all 0.3s ease;
}

.gmail-card:hover {
    transform: scale(1.02);
}

/* Add Key Button (Floating) */
.add-key-btn {
    position: fixed;
    bottom: 20px;
    right: 20px;
    padding: 15px 20px;
    background: cyan;
    font-size: 16px;
    font-weight: bold;
    border-radius: 50px;
    cursor: pointer;
    box-shadow: 0 0 10px cyan;
}

.add-key-btn:hover {
    background: white;
    color: black;
}

/* Drawer (Sidebar) */
.drawer {
    position: fixed;
    right: -283px;
    top: 0;
    width: 350px;
    height: 100%;
    background: #002c3d;
    padding: 20px;
    transition: right 0.3s ease;
    z-index: 10;
    box-shadow: -5px 0px 10px rgba(255, 255, 255, 0.8);
}

.drawer .close-btn {
    position: absolute;
    top: 10px;
    right: 10px;
    font-size: 22px;
    cursor: pointer;
    color: white;
    background: red;
    border-radius: 50%;
    padding: 5px 10px;
    border: none;
}

/* Input & Dropdown Styling */
.input-field, .dropdown {
    width: 100%;
    padding: 10px;
    margin-top: 15px;
    border-radius: 5px;
    background: black;
    color: white;
    border: 2px solid cyan;
}

/* Add Key Button Inside Drawer */
.add-btn {
    width: 100%;
    padding: 10px;
    background: cyan;
    border: none;
    font-size: 18px;
    font-weight: bold;
    cursor: pointer;
    margin-top: 20px;
}

/* Overlay for Drawer */
#overlay {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.7);
    z-index: 9;
}

/* Responsive Design */
@media (max-width: 768px) {
    .admin-title {
        font-size: 6vw;
    }
    .admin-title-box {
        padding: 15px 25px;
        max-width: 90%;
    }
    .drawer {
        width: 280px;
    }
}

.chart-container {
  width: 80%;
  max-width: 500px;
  margin: 30px auto;
  padding: 20px;
  background: rgba(0, 255, 255, 0.1);
  border: 2px solid cyan;
  border-radius: 15px;
  box-shadow: 0px 0px 15px cyan;
}
   
</style> 

<style>
  .btn {
    padding: 10px 15px;
    margin: 5px;
    border: none;
    font-size: 14px;
    cursor: pointer;
    border-radius: 5px;
    width: 100%;
  }
  .cyan {
    background-color: cyan;
    color: black;
  }
  .red {
    background-color: red;
    color: white;
  }
  .gmail-card {
    padding: 20px;
    border: 1px solid #ccc;
    color: white;
    text-align: center;
    border-radius: 10px;
  }
</style>

  </head>    
  <body>  

	<div class="admin-title-container">
	  <div class="admin-title-box">
		<h1 class="admin-title">âš¡Aviator Super Admin Panelâš¡</h1>
	  </div>
	</div>
	
	<!-- Gmail Drawer Button -->
<button class="gmail-btn" onclick="openGmailDrawer()">ðŸ“© View Emails</button>    

<!-- Gmail Drawer -->
<div class="gmail-drawer" id="gmailDrawer">    
    <button class="close-btn" onclick="closeGmailDrawer()">âœ–</button>    
    <h3>Authenticated Users</h3>    
    <div id="gmailList"></div>    
</div>



	<div id="overlay" onclick="closeDrawer()"></div> 

	<button class="add-key-btn" onclick="openDrawer()">âž• Add Key</button> 

	<div class="drawer" id="drawer">    

	  <button class="close-btn" onclick="closeDrawer()">âœ–</button>    

	  <h3>Add New Key</h3>    

	  <input type="text" class="input-field" id="keyUsername" placeholder="Username">    
	  <input type="text" class="input-field" id="keyInput" placeholder="Enter Key">    

	  <select class="dropdown" id="keyExpiry">    
		<option value="1">1 Day</option>  
		<option value="2">2 Days</option>  
		<option value="3">3 Days</option>  
		<option value="4">4 Days</option>  
		<option value="5">5 Days</option>  
		<option value="6">6 Days</option>  
		<option value="7">7 Days</option>  
		<option value="8">8 Days</option>  
		<option value="9">9 Days</option>  
		<option value="10">10 Days</option>  
		<option value="11">11 Days</option>  
		<option value="12">12 Days</option>  
		<option value="13">13 Days</option>  
		<option value="14">14 Days</option>  
		<option value="15">15 Days</option>  
		<option value="16">16 Days</option>  
		<option value="17">17 Days</option>  
		<option value="18">18 Days</option>  
		<option value="19">19 Days</option>  
		<option value="20">20 Days</option>  
		<option value="21">21 Days</option>  
		<option value="22">22 Days</option>  
		<option value="23">23 Days</option>  
		<option value="24">24 Days</option>  
		<option value="25">25 Days</option>  
		<option value="26">26 Days</option>  
		<option value="27">27 Days</option>  
		<option value="28">28 Days</option>  
		<option value="29">29 Days</option>  
		<option value="30">30 Days</option>  
	  </select> 

	  <button class="add-btn" onclick="addKey()">Add Key</button> 
	</div>  
	<div class="user-card-container">

	  <h2 class="user-card-title">âœ” registered âœ”<br />  <br/>ðŸ‘¨ users ðŸ‘¨</h2>
	  <div id="usersList" class="user-list"></div>
	</div>
	
	
<!-- Canvas for Chart -->
<div class="chart-container">
  <canvas id="adminChart"></canvas>
</div>


<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
  import { getAuth, onAuthStateChanged, sendPasswordResetEmail, deleteUser } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
  import { getFunctions, httpsCallable, connectFunctionsEmulator } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-functions.js";
  
  // ðŸ”¹ Firebase Configuration    
  const firebaseConfig = {
    apiKey: "AIzaSyB1bRRidVuc5T4WuH_b_D7s3ncCk0e6o4k",
    authDomain: "superadminpanel-2757.firebaseapp.com",
    projectId: "superadminpanel-2757",
    storageBucket: "superadminpanel-2757.appspot.com",
    messagingSenderId: "220202072359",
    appId: "1:220202072359:web:2b6e25819406c478fa1102",
    measurementId: "G-RX382CMBGZ"
  };
  
  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const functions = getFunctions(app);
  // Optional: If using emulator for functions
  // connectFunctionsEmulator(functions, "localhost", 5001); 
  
  // ðŸ”¹ Fetch Authenticated User & Display Buttons
  async function fetchAuthenticatedUser() {
    console.log("Checking authentication...");
    
    onAuthStateChanged(auth, async (user) => {
      const usersList = document.getElementById("gmailList");
      if (!usersList) {
        console.error("gmailList element not found!");
        return;
      }
      
      usersList.innerHTML = ""; // Clear previous entries
      
      if (user) {
        console.log("Logged-in user:", user.email);
        
        // ðŸ”¹ Fetch User Status (Disabled or Enabled)
        const getUserStatus = httpsCallable(functions, "getUserStatus");
        try {
          const result = await getUserStatus({ uid: user.uid });
          const isDisabled = result.data.disabled;
          
          usersList.innerHTML += `    
            <div class="gmail-card">    
              <p><strong>Email:</strong> ${user.email}</p>    
              <p><strong>Status:</strong> ${isDisabled ? "Disabled" : "Enabled"}</p>    
              <button class="btn cyan" onclick="resetPassword('${user.email}')">Reset Password</button>    
              <button class="btn ${isDisabled ? 'green' : 'red'}" onclick="toggleAccountStatus('${user.uid}', ${isDisabled})">
                ${isDisabled ? 'Enable Account' : 'Disable Account'}
              </button>    
              <button class="btn red" onclick="deleteAccount()">Delete Account</button>    
            </div>    
          `;
        } catch (error) {
          console.error("Error fetching user status:", error);
          alert(`Error fetching user status: ${error.message}`);
        }
      } else {
        usersList.innerHTML = `<p>No authenticated user found. Please log in.</p>`;
      }
    });
  }
  
  // ðŸ”¹ Reset Password Function
  window.resetPassword = async (email) => {
    try {
      await sendPasswordResetEmail(auth, email);
      alert(`Password reset link sent to ${email}`);
    } catch (error) {
      alert(`Error: ${error.message}`);
    }
  };
  
  // ðŸ”¹ Toggle Disable/Enable Account
  window.toggleAccountStatus = async (uid, isDisabled) => {
    try {
      const toggleUserStatus = httpsCallable(functions, "toggleUserStatus");
      await toggleUserStatus({ uid, disable: !isDisabled });
      alert(`Account ${isDisabled ? "enabled" : "disabled"} successfully.`);
      fetchAuthenticatedUser(); // Refresh UI
    } catch (error) {
      alert(`Error: ${error.message}`);
    }
  };
  
  // ðŸ”¹ Delete Account Function
  window.deleteAccount = async () => {
    const user = auth.currentUser;
    if (user) {
      try {
        await deleteUser(user);
        alert("Account deleted successfully.");
      } catch (error) {
        alert(`Error: ${error.message}. You may need to re-authenticate.`);
      }
    } else {
      alert("No authenticated user found.");
    }
  };
  
  // ðŸ”¹ Open & Close Gmail Drawer  
  window.openGmailDrawer = () => {
    document.getElementById("gmailDrawer").style.left = "0";
    document.getElementById("overlay").style.display = "block";
    fetchAuthenticatedUser(); // Fetch email and status when opening
  };
  
  window.closeGmailDrawer = () => {
    document.getElementById("gmailDrawer").style.left = "-350px";
    document.getElementById("overlay").style.display = "none";
  };
</script>

<script type="module">  

    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";    
    import { getFirestore, collection, getDocs, doc, setDoc, deleteDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";    
  
    // Firebase Configuration    
    const firebaseConfig = {    
        apiKey: "AIzaSyB1bRRidVuc5T4WuH_b_D7s3ncCk0e6o4k",    
        authDomain: "superadminpanel-2757.firebaseapp.com",    
        projectId: "superadminpanel-2757",    
        storageBucket: "superadminpanel-2757.appspot.com",    
        messagingSenderId: "220202072359",    
        appId: "1:220202072359:web:2b6e25819406c478fa1102",    
        measurementId: "G-RX382CMBGZ"    
    };    
  
    const app = initializeApp(firebaseConfig);    
    const db = getFirestore(app);    
  
    // Fetch Users    
    async function fetchUsers() {    
        const usersList = document.getElementById("usersList");    
        if (!usersList) return;    
        usersList.innerHTML = "";    
  
        const querySnapshot = await getDocs(collection(db, "keys"));    
  
        querySnapshot.forEach((doc) => {    
            const userData = doc.data();    
  
            usersList.innerHTML += `    
                <div class="user-card">    
                    <p><strong>Username:</strong> ${userData.username}</p>    
                    <p><strong>Key:</strong> ${doc.id}</p>    
                    <p><strong>Expiry:</strong> ${userData.expiry}</p>    
                    <button class="extend-btn" onclick="extendExpiry('${doc.id}')">Extend</button>    
                    <button class="delete-btn" onclick="deleteUser('${doc.id}')">Delete</button>    
                </div>    
            `;    
        });    
    }    
  
    // Extend Key Expiry    
    async function extendExpiry(keyId) {    
        const newDate = prompt("Enter new expiry date (DD-MM-YYYY):");    
        if (newDate && /^\d{2}-\d{2}-\d{4}$/.test(newDate)) {    
            await setDoc(doc(db, "keys", keyId), { expiry: newDate }, { merge: true });    
            alert("Expiry Extended!");    
            fetchUsers();    
        } else {    
            alert("Invalid date format! Use DD-MM-YYYY.");    
        }    
    }    
  
    // Delete User Key    
    async function deleteUser(keyId) {    
        if (confirm("Are you sure you want to delete this key?")) {    
            await deleteDoc(doc(db, "keys", keyId));    
            alert("User Deleted!");    
            fetchUsers();    
        }    
    }    
  
    // Add New Key    
async function addKey() {
  const usernameField = document.getElementById("keyUsername");
  const keyField = document.getElementById("keyInput");
  const expiryField = document.getElementById("keyExpiry");
  
  const username = usernameField.value.trim();
  const key = keyField.value.trim();
  const expiryDays = expiryField.value;
  
  if (!username || !key || !expiryDays) {
    alert("Please fill in all fields!");
    return;
  }
  
  const expiryDate = new Date();
  expiryDate.setDate(expiryDate.getDate() + parseInt(expiryDays));
  const formattedExpiry = expiryDate.toLocaleDateString('en-GB').replace(/\//g, "-");
  
  const keyDoc = doc(db, "keys", key);
  await setDoc(keyDoc, {
    username: username,
    expiry: formattedExpiry
  });
  
  alert("Key Added!");
  
  // Reset fields after adding a key
  usernameField.value = "";
  keyField.value = "";
  expiryField.value = "1"; // Reset to default value    
  
  fetchUsers();
  closeDrawer();
}    
  
    // Open & Close Drawer    
    function openDrawer() {    
        document.getElementById("drawer").style.right = "0";    
        document.getElementById("overlay").style.display = "block";    
    }    
  
    function closeDrawer() {    
        document.getElementById("drawer").style.right = "-350px";    
        document.getElementById("overlay").style.display = "none";    
    }    
  
    window.fetchUsers = fetchUsers;    
    window.extendExpiry = extendExpiry;    
    window.deleteUser = deleteUser;    
    window.addKey = addKey;    
    window.openDrawer = openDrawer;    
    window.closeDrawer = closeDrawer;    
  
    document.addEventListener("DOMContentLoaded", fetchUsers);    
</script> 

<script type="module">
  import { getFirestore, collection, getDocs } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
  
  const db = getFirestore();
  
  async function loadChartData() {
    const keysCollection = collection(db, "keys");
    const querySnapshot = await getDocs(keysCollection);
    
    let activeKeys = 0;
    let expiredKeys = 0;
    const today = new Date();
    
    querySnapshot.forEach((doc) => {
      const keyData = doc.data();
      const expiryDate = new Date(keyData.expiry.split("-").reverse().join("-")); // Convert DD-MM-YYYY to Date
      
      if (expiryDate >= today) {
        activeKeys++;
      } else {
        expiredKeys++;
      }
    });
    
    renderChart(activeKeys, expiredKeys);
  }
  
  function renderChart(active, expired) {
    const ctx = document.getElementById('adminChart').getContext('2d');
    new Chart(ctx, {
      type: 'doughnut',
      data: {
        labels: ['Active Keys', 'Expired Keys'],
        datasets: [{
          data: [active, expired],
          backgroundColor: ['#00ff00', '#ff0000'],
          hoverOffset: 4
        }]
      },
      options: {
        responsive: true,
        plugins: {
          legend: {
            position: 'top',
            labels: {
              color: 'white'
            }
          }
        }
      }
    });
  }
  
  document.addEventListener("DOMContentLoaded", loadChartData);
</script>
  </body>
</html>